## 課題1
- whereがない場合、検索結果を出さないようにする
- そもそもこの構成はtenant_idをクライアントから直接queryとかでたたけるように見えるので、認証をかけて認証情報からtenant_idを取得するように変更する
- どれだけ忙しくてもコードレビューを通す運用にする
- テストを書く

## 課題2
### テナント毎にデータベースを分割する
#### メリット
- 誤って他のテナントのデータを見てしまうエラーを防ぐことができる
- 一部のテナントに重大な問題が発生しても、他のテナントには影響しない
#### デメリット
- 純粋に管理コストと金銭的なコストがかかる
- 全テナントをそれぞれデプロイしないといけない
- 全テナントで共通の問題が発覚しても、同等の処理をすべてで行う必要があり、処理の共通化がしにくい

### テナント毎にスキーマを分割する
#### メリット
- コストがかからない
- 全テナント共通の処理を書くことができる
#### デメリット
- データ量が増えるのですべて返却する、みたいな処理をすると重たくなりそう
- なにか問題が発生した場合、全テナントを一気に治せるが、逆に言うと全テナントが止まるリスクも有る
- マイグレーションコストがかかる


### すべてのテナントで同じスキーマを使う
#### メリット
- コストがかからない
- すべて共通処理が書けるので一度設計が行われるとその後のメンテナンスが楽

#### デメリット
- すべて共通な分、アプリケーション層で絞り込みをするなど、アプリケーション層の開発コストがかかる
- すべて共通のスキーマにするために、汎用性を高めていくとスキーマの作りが複雑になりそう
- なにか問題が発生した場合、全テナントを一気に治せるが、逆に言うと全テナントが止まるリスクも有る

### RLSと、これを活用したマルチテナントアーキテクチャの実装方法
- ENABLE ROW LEVEL SECURITYを適用する
- 作成したテーブルに対して、CREATE POLICYする
  - テナントIDに一致する行にアクセスでき、かつ自分のアカウントのテナントIDの行のみアクセスできるポリシー
- コネクション取得時にテナントIDをセットする

参考
https://times.hrbrain.co.jp/entry/postgresql-row-level-security

https://labs.septeni.co.jp/entry/2022/03/28/193223

https://www.postgresql.jp/document/9.6/html/ddl-rowsecurity.html