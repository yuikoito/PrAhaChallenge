## 回答

![image](https://raw.githubusercontent.com/yuikoito/PrAhaChallenge/master/db/db-modeling-2/DB2%20Diagram.drawio.png)


### 考えたこと
- メッセージとスレッドメッセージを分けるか
  - ほとんど必要とするデータは同じなので、２つのテーブルにするか１つにまとめるかを悩んだ
  - 最終的にアプリを作る場合に、親メッセージを取得した後に、それぞれのメッセージIDでスレッドメッセージを検索してスレッドとして表示、という方が作りやすいと判断した。
  - また、全データを一度に取得してそれが親データなのか、子なのかを判断するのは計算負荷がかかるとも考えた。
  - そのためスレッドメッセージを持つ場合は、親からみてすぐにわかるようにスレッドメッセージを持つかどうかフラグを追加した。（メッセージを表示させる場合に、そのメッセージにスレッドをもつUIが必要かどうかの判断を早く行いたい。仮にこのフラグがないと、そのメッセージが子を持つかどうかは全レコードからの探索が必要）
  - また、横断機能をつけるとしてもSQLなら複数のテーブルにまたがって検索はできるので問題ないと考えた。
  - ここはものすごく悩んだので、正直どちらが最適解かはわかってない

- メッセージ及びスレッドメッセージにチャネルIDが存在している理由
  - メッセージではどのチャネルに登録されたかを知る必要があるので、必要なのは自明
  - スレッドメッセージの場合は投稿されたチャネルを知るだけなら親のメッセージIDからたどることができるので不要に思える
  - ただ、**そのチャネルに所属しているユーザにしか、メッセージ・スレッドメッセージが見えないこと**という条件なので、実際に検索をかける場合にはチャネルIDでフィルタリングしたい。
  - また、複数のテーブルにまたがって検索をすることになるので、メッセージ・スレッドメッセージで同じクエリを叩きたいと考えた。
　
### プラスαで実際組むなら最低限必要だろうなということ（今回の仕様には含まれてないが少し考えたこと）
- 認証部分でoAuthなどを使って、ユーザーテーブルのIDはoAuthのIDと一致させる必要がある
- メールアドレスが必要であれば、oAuth側に持たせる
