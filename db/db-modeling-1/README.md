# DBモデリング1 

## 課題1

![image](https://user-images.githubusercontent.com/43722788/184544994-ceae7038-9cbd-4497-9b5e-5831af5fffd7.png)

- メニュー種別...セットメニューかお好みずしか、「盛り込み」なのか「一皿100円寿司」なのかなどを管理するテーブル。セットメニューかお好みずしかを大カテゴリ、その他を小カテゴリとしてテーブルをわける事も考えましたが、これぐらいなら一つのテーブルで管理しても問題ないと判断し、メニュー種別テーブルのみを作りました。
- メニュー...メニューの内容を管理するテーブル。作成日と更新日があるのは、今後メニューが変更になったりする可能性を考えてです。
- 注文詳細...そのメニューが何個頼まれたか管理するテーブル。具体的な注文日や注文者情報は注文概要IDから取得します。
- 注文概要...注文票の内容を管理するテーブル。
- カスタマー...カスタマー情報を管理するテーブル。住所は課題３にあるように今後出前とかを考えるなら必要かなと思いオプショナルで追加しました。同じく今後カスタマー情報を保持し続けるとすれば、更新することもあると思い、作成日、更新日もオプショナルとして追加しています。
- 決済...支払状況を管理するテーブル。決済日がnullであれば、未決済とみなします。決済方法に関しては、クレカ情報の保持などが今後必要かと考えてです。オプショナルなので今は不要です。


### 税金を保持すべきか？
- 正直現在の要件だと税金を表示すべきかどうかはわからないのでなんとも言えない。
- もし過去の履歴をさかのぼって税金と税別の金額を出す必要があるのなら、決済テーブルの中の金額の部分を税別金額と税金に分けるべき。
- 税金自体をDBから取得するかどうかに関しては、将来的に税金の変動を確認する必要があるのであれば、DBで持っておいて、変更は許容せずに、レコード追加の方式でやるのが良さそう。
- 過去の税金の変動を確認する必要がないのであれば、どうせサーバーサイドで金額の計算は行うのだから、サーバー側で環境変数として持つのと変わらないと思う。

### 任意課題

物理モデル...実際のDBで使うキー名で記載された図
論理モデル...人がわかりやすいような名前で記載された図

例：
ユーザーテーブルを物理モデルで書くとすると、以下
```
id: string
name: string
display_name: string
created_at: string
updated_at: string
...
```
論理モデルの場合は以下のようになる

```
id
本名
表示名
作成日
更新日
...
```

## 課題2
- 注文詳細テーブルにシャリの大小のカラムを追加する
- 寿司ネタが毎月何個売れているかは以下の手順で求められるので変更は不要
  1. 注文概要テーブルから注文日で各月分を検索
  2. 注文詳細テーブルから1で求めた注文概要IDに一致する履歴を検索
  3. 2より各メニューIDと個数を求める
  4. 3で求めたメニューIDから、メニューテーブルを検索してメニューの名前（寿司ネタ名）を取得

## 課題3
### 私
- 今後は出前を受け付けるようになりました。どのようにテーブル設計をするべきでしょうか?
### 大平さん
- 税込価格で表示したい
- セットメニュー内でも個別の寿司ごとにさび抜きかどうかを選択したい
### junseiさん
- 現場では、ワサビ「ぬき」の欄に ✓ マークに加えて、ワサビ抜きの枚数を数字で書く運用がされていました。それに対応して、ワサビを抜く枚数を指定できるようにしてください。
- 某人気店「Plate of silver」に対抗して、セットメニューを入れ替えれるようにしたいとシャッチョーがお達ししました。それに対応して、セットメニューのネタを自由に入れ替えた注文を保存できるようにしてください。(ここでは、セットメニューの金額はセットメニューの持つネタの金額の合計とします。また、入れ替える前のネタと入れ替えた後のネタの履歴を保存しておく必要があります。)

### 考えたこと
- junseiさんのわさび抜き部分のものに関しては大平さんのものの派生系という感じがするので、大平さんの方に対応すれば両方対応できそう。
- 大平さんの税込価格で表示したいに関しては最初から私は税込みしか考えていなかったので変更不要に見えるが、せっかくなので税抜価格も表示するというようにしてDBを変更しようと思う。（APIサーバーを建てる際に、BEからDBの税込みから考えて税抜金額を出せば終わりな気もするけどせっかくなので・・）


![image](https://github.com/yuikoito/PrAhaChallenge/blob/master/db/db-modeling-1/DB1-update%20Diagram.drawio.png)

#### 変更履歴テーブルに関して
- 通常の注文の場合にメニューのレコードが増えていくのが嫌なのでつけた
- このテーブルがあることにより、変更がない場合は通常の注文ができて、たとえば「わだつみのマグロだけさび抜きに」とかを頼まれた場合は、注文詳細テーブルのレコードとしてはサビあり、わだつみという履歴が残るが、変更履歴テーブルの中で、マグロさび抜きというレコードが作成される。
- メニューの一部ネタを変更したい場合も同様
